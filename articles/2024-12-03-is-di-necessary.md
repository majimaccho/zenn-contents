---
title: "結局、DIは必要なのか？"
emoji: "🦍"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["books"]
published: false
---

https://x.com/sonatard/status/1862813057820541296
https://x.com/naoya_ito/status/1862860939336515650

最近 DI の中でも Repository について以下のような話が X で飛び交っていました。

DI はもはや不要の長物なのでしょうか？

## なぜ依存を注入するのか

[なぜ依存を注入するのか　 DI の原理・原則とパターン](https://book.mynavi.jp/ec/products/detail/id=143373)では DI を導入する目的について以下のように説明しています。

> ソフトウェア開発において依存注入は導入すること辞退が目的なのではなく、目的を達成するための手段でしかありません。依存注入を導入するためにインターフェースを介する設計にすることでオブジェクト間の関係は疎結合になり、その結果、保守容易性が向上します。

つまり、DI は疎結合にすることによって得られるメリットを享受するための方法の 1 つということになります。

## DI のデメリット

DI を行うことで疎結合なソフトウェアを作ることは、メリットがある一方で、トレードオフとなるデメリットもあります。
その一つはデータの詰め替えが多くなってしまい、コードベースの多くを詰め替えのためのコードに割かなければならなくなることです。

[kawasima さんの「データ詰め替え戦略」](https://scrapbox.io/kawasima/%E3%83%87%E3%83%BC%E3%82%BF%E8%A9%B0%E3%82%81%E6%9B%BF%E3%81%88%E6%88%A6%E7%95%A5)の中で、Clean Architecture で Full Mapping している場合と Ruby on Rails の比較がされておりこう見ると詰め替えのコード量の差がわかりやすいと思います。

Clean Architecture で Full Mapping している場合
![Clean ArchitectureでFull Mappingしている場合詰め替えが4箇所で発生する](/images/kawasima_clean_arch_full_mapping.png)

全く Mapping を行わない Ruby on Rails
![全くMappingを行わないRuby on Rails](/images/kawasima_rails_no_mapping.png)

<!-- Web APIでDIから得られるメリットは
コードの疎結合さとテストの容易性（依存をなぜ注入するのか）で
RDBについては管理されたプロセス外依存なので、ちゃんと結合テストで本物を使った方が良い→この観点では不要
ドメイン層についてはIOを処理の開始と終了の両端に配置することで、プロセス外依存を含まない純粋関数にすることができる（単体テストの考え方、使い方と関数型ドメインモデリングそれぞれで紹介）
どの程度、疎結合さを必要とするかによって
Repositoryの分割はするが、インターフェースをドメイン層に持たせない
そもそも分割しない
というオプションがある
ドメイン駆動設計を始めようでは
ドメインの複雑さによってトランザクションスクリプトとドメインモデルパターンを選択するという考え方が紹介されている。 -->
